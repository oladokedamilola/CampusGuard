<!-- templates/base/sidebar.html -->
<!-- Sidebar Overlay (Mobile Only) -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
        <a href="{% url 'dashboard:index' %}" class="sidebar-brand">
            <div class="brand-logo">
                <i class="fas fa-shield-alt"></i>
            </div>
            <div class="brand-logo-text">
                <div class="brand-main">
                    <span class="text-gradient">CampusGuard</span>
                    <span class="text-secondary">AI</span>
                </div>
                <div class="brand-sub">Evidence Intelligence</div>
            </div>
        </a>
        <!-- Close button for mobile (hidden on desktop) -->
        <button class="sidebar-close-btn d-lg-none" id="mobileSidebarClose" aria-label="Close sidebar">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- Sidebar Navigation -->
    <nav class="sidebar-nav">
        <!-- Dashboard Section -->
        <div class="nav-section">
            <div class="nav-section-title">DASHBOARD</div>
            <ul class="nav flex-column">
                <!-- Role-specific dashboards -->
                {% if user.is_admin or user.is_superuser %}
                <li class="nav-item">
                    <a href="{% url 'dashboard:admin_dashboard' %}" class="nav-link {% if request.resolver_match.url_name == 'admin_dashboard' %}active{% endif %}">
                        <i class="fas fa-user-shield"></i>
                        <span class="nav-link-text">Admin Dashboard</span>
                    </a>
                </li>
                {% endif %}
                
                {% if user.is_manager or user.is_admin or user.is_superuser %}
                <li class="nav-item">
                    <a href="{% url 'dashboard:manager_dashboard' %}" class="nav-link {% if request.resolver_match.url_name == 'manager_dashboard' %}active{% endif %}">
                        <i class="fas fa-user-tie"></i>
                        <span class="nav-link-text">Manager Dashboard</span>
                    </a>
                </li>
                {% endif %}
                
                {% if user.is_viewer %}
                <li class="nav-item">
                    <a href="{% url 'dashboard:viewer_dashboard' %}" class="nav-link {% if request.resolver_match.url_name == 'viewer_dashboard' %}active{% endif %}">
                        <i class="fas fa-eye"></i>
                        <span class="nav-link-text">My Dashboard</span>
                    </a>
                </li>
                {% endif %}
                
                <!-- Quick link to My Reports -->
                <li class="nav-item">
                    <a href="{% url 'reports:my_reports' %}" class="nav-link {% if 'my' in request.path %}active{% endif %}">
                        <i class="fas fa-file-alt"></i>
                        <span class="nav-link-text">My Reports</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Incident Reporting Section -->
        <div class="nav-section">
            <div class="nav-section-title">INCIDENT REPORTING</div>
            <ul class="nav flex-column">
                <!-- All users can report incidents -->
                <li class="nav-item">
                    <a href="{% url 'reports:create' %}" class="nav-link {% if request.resolver_match.url_name == 'create' %}active{% endif %}">
                        <i class="fas fa-flag"></i>
                        <span class="nav-link-text">Report Incident</span>
                        <span class="nav-badge badge bg-primary">NEW</span>
                    </a>
                </li>
                
                <!-- Reports Queue - for Managers and Admins -->
                {% if user.is_manager or user.is_admin or user.is_superuser %}
                <li class="nav-item">
                    <a href="{% url 'reports:reports_queue' %}" class="nav-link {% if 'manager/queue' in request.path %}active{% endif %}">
                        <i class="fas fa-inbox"></i>
                        <span class="nav-link-text">Reports Queue</span>
                        {% if user.is_manager or user.is_admin %}
                        <!-- Placeholder badge - you can implement actual count later -->
                        <span class="nav-badge badge bg-danger">0</span>
                        {% endif %}
                    </a>
                </li>
                {% endif %}
                
                <!-- All Reports - for Managers and Admins -->
                {% if user.can_view_all_reports %}
                <li class="nav-item">
                    <a href="{% url 'reports:list' %}" class="nav-link {% if request.resolver_match.url_name == 'list' and 'my' not in request.path %}active{% endif %}">
                        <i class="fas fa-list"></i>
                        <span class="nav-link-text">All Reports</span>
                    </a>
                </li>
                {% endif %}
                
                <!-- Case Management - for Managers and Admins -->
                {% if user.can_manage_cases %}
                <li class="nav-item">
                    <a href="{% url 'reports:case_management' %}" class="nav-link {% if 'manager/cases' in request.path %}active{% endif %}">
                        <i class="fas fa-tasks"></i>
                        <span class="nav-link-text">Case Management</span>
                    </a>
                </li>
                {% endif %}
                
                <!-- Search Reports - for Managers and Admins -->
                {% if user.can_view_all_reports %}
                <li class="nav-item">
                    <a href="{% url 'reports:search' %}" class="nav-link {% if 'manager/search' in request.path %}active{% endif %}">
                        <i class="fas fa-search"></i>
                        <span class="nav-link-text">Search Reports</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
        
        <!-- Analytics Section -->
        {% if user.can_view_analytics %}
        <div class="nav-section">
            <div class="nav-section-title">ANALYTICS</div>
            <ul class="nav flex-column">
                <!-- Analytics Dashboard - for Managers and Admins -->
                {% if user.can_view_analytics %}
                <li class="nav-item">
                    <a href="{% url 'reports:analytics' %}" class="nav-link {% if 'manager/analytics' in request.path %}active{% endif %}">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-link-text">Analytics Dashboard</span>
                    </a>
                </li>
                {% endif %}
                
                <!-- System Statistics - for Admins only -->
                {% if user.is_admin or user.is_superuser %}
                <li class="nav-item">
                    <a href="{% url 'reports:system_stats' %}" class="nav-link {% if 'admin/system-stats' in request.path %}active{% endif %}">
                        <i class="fas fa-chart-pie"></i>
                        <span class="nav-link-text">System Statistics</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
        {% endif %}
        
        <!-- Administration Section -->
        {% if user.is_admin or user.is_superuser %}
        <div class="nav-section">
            <div class="nav-section-title">ADMINISTRATION</div>
            <ul class="nav flex-column">
                <!-- User Management - for admins only -->
                {% if user.can_manage_users %}
                <li class="nav-item">
                    <a href="{% url 'admin:accounts_user_changelist' %}" class="nav-link {% if 'admin/accounts/user' in request.path %}active{% endif %}">
                        <i class="fas fa-users"></i>
                        <span class="nav-link-text">User Management</span>
                    </a>
                </li>
                {% endif %}
                
                <!-- Invitations - for admins only -->
                {% if user.can_invite_users %}
                <li class="nav-item">
                    <a href="{% url 'admin:accounts_invitation_changelist' %}" class="nav-link {% if 'admin/accounts/invitation' in request.path %}active{% endif %}">
                        <i class="fas fa-user-plus"></i>
                        <span class="nav-link-text">Invitations</span>
                    </a>
                </li>
                {% endif %}
                
                <!-- Reports Export - for admins and managers -->
                {% if user.can_export_data %}
                <li class="nav-item">
                    <a href="{% url 'reports:export_reports' %}" class="nav-link {% if 'admin/export' in request.path %}active{% endif %}">
                        <i class="fas fa-download"></i>
                        <span class="nav-link-text">Export Data</span>
                    </a>
                </li>
                {% endif %}
                
                <!-- Django Admin Panel - only for superusers -->
                {% if user.is_superuser %}
                <li class="nav-item">
                    <a href="{% url 'admin:index' %}" class="nav-link {% if 'admin' == request.resolver_match.app_name %}active{% endif %}">
                        <i class="fas fa-cogs"></i>
                        <span class="nav-link-text">Django Admin</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
        {% endif %}
        
        <!-- Account Section -->
        <div class="nav-section">
            <div class="nav-section-title">ACCOUNT</div>
            <ul class="nav flex-column">
                <!-- Profile -->
                <li class="nav-item">
                    <a href="{% url 'accounts:profile' %}" class="nav-link {% if 'profile' in request.path %}active{% endif %}">
                        <i class="fas fa-user"></i>
                        <span class="nav-link-text">My Profile</span>
                    </a>
                </li>
                
 
                
                <!-- Notifications -->
                <li class="nav-item">
                    <a href="{% url 'dashboard:notifications' %}" class="nav-link {% if 'notifications' in request.path %}active{% endif %}">
                        <i class="fas fa-bell"></i>
                        <span class="nav-link-text">Notifications</span>
                        <!-- Simple badge - remove complex filter -->
                        <span class="nav-badge badge bg-danger">0</span>
                    </a>
                </li>
                
                <!-- Logout -->
                <li class="nav-item">
                    <a href="{% url 'accounts:logout' %}" class="nav-link text-danger">
                        <i class="fas fa-sign-out-alt"></i>
                        <span class="nav-link-text">Logout</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Role Badge -->
        <div class="nav-section mt-auto">
            <div class="nav-section-title">CURRENT ROLE</div>
            <div class="px-3 py-2">
                <span class="badge 
                    {% if user.is_admin or user.is_superuser %}bg-danger
                    {% elif user.is_manager %}bg-primary
                    {% elif user.is_viewer %}bg-success
                    {% else %}bg-secondary{% endif %} 
                    w-100 text-center py-2">
                    <i class="fas 
                        {% if user.is_admin or user.is_superuser %}fa-user-shield
                        {% elif user.is_manager %}fa-user-tie
                        {% elif user.is_viewer %}fa-eye
                        {% else %}fa-user{% endif %} me-2"></i>
                    {{ user.get_role_display }}
                </span>
                {% if user.is_superuser %}
                <small class="text-warning d-block mt-1 text-center">
                    <i class="fas fa-star"></i> Superuser
                </small>
                {% endif %}
                <small class="text-muted d-block mt-1 text-center">
                    {{ user.institution|default:"No institution" }}
                </small>
                <small class="text-muted d-block mt-1 text-center">
                    Reports: {{ user.reported_incidents.count }}
                </small>
            </div>
        </div>
    </nav>
    
    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
        <small class="text-white-50">
            CampusGuard AI v1.0<br>
            Evidence Intelligence Platform<br>
            Â© {% now "Y" %}
        </small>
    </div>
</aside>